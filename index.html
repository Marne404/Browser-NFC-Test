<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>NFC JSON Reader</title>
</head>
<body>
    <h1>NFC Tag Reader</h1>
    <p id="status">Halte den NFC-Tag ans Gerät...</p>
    <p>Name vom Tag: <span id="name">-</span></p>

    <script>
        const statusEl = document.getElementById("status");
        const nameEl = document.getElementById("name");

        // Prüfen, ob Web NFC unterstützt wird
        if ("NDEFReader" in window) {
            const ndef = new NDEFReader();

            async function startNFC() {
                try {
                    await ndef.scan();
                    statusEl.textContent = "Scanning... Halte den Tag ans Gerät.";

                    ndef.onreading = event => {
                        const decoder = new TextDecoder();
                        for (const record of event.message.records) {
                            if (record.recordType === "text") {
                                const jsonStr = decoder.decode(record.data);
                                try {
                                    const data = JSON.parse(jsonStr);
                                    if (data.name) {
                                        nameEl.textContent = data.name;
                                    }
                                } catch(e) {
                                    console.error("Ungültiger JSON-String:", e);
                                }
                            }
                        }
                    };

                } catch (error) {
                    statusEl.textContent = "Fehler beim NFC-Scan: " + error;
                    console.error(error);
                }
            }

            startNFC();

        } else {
            statusEl.textContent = "Web NFC wird von diesem Gerät/Browser nicht unterstützt.";
        }
    </script>
</body>
</html>